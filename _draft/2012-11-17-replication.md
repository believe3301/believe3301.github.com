---
layout: post
title: 理解数据库以及分布式系统中的复制
category: linux
tags: [replication, distributed system,  linux]
---

导论:


复制是一个在分布式系统以及数据库都很有意思的话题。两者的解决方案在观念上相似但是在很多方面都有所区别：模型/假设/机制/能提供的保障以及实现。

在这篇论文中，我们提供一个抽象和"中性"的框架去比较在两者社区中使用的复制技术，而不管其中许多细微的差别。该框架的设计主要在于加强不同机制所发挥的作用,以及方便进行比较。

通过这样，可以对许多观点进行功能性的比较，有理论和实践的双重意义。

这篇论文描述了在两边社区使用的复制技术，比较它们，并指出整合的方法，以提供更好/更强大的复制协议。

关键字：
复制协议，数据库复制，复制比较，容错系统，组通讯，分布式系统

技术领域：
分布式容错系统以及分布式算法

1 介绍
复制在很多领域进行研究，尤其是在分布所系统（主要用于容错）和数据库（主要用于性能因素）。
在这两个领域，使用的技术和机制是相似的，但是比较两边社区开发的协议是一个令人沮丧的实验，许多研究者有不太成功的尝试。
由于涉及到许多细微的差别，机制在观念上相同，但是导致在实践上非常不同。因此，将一个领略的成果应用到其它的领域很困难。
在过去的几年，作为DRAGON项目的一部分，我们尽我们的努力通过采用一些组通讯原语的某些属性去加强数据库的复制机制。
我们已经展示了组通讯如何嵌入到数据库，以及如果作为事物管理器的一部分去保障在复制的数据上序列化执行事务。
我们还展示了可以在执行事务的开销中隐藏一些组通信相关的开销，从而大大提高了性能，消除组通信原语严重的局限性。
这项工作证明了复制协议被两个社区一致理解的重要性和必要性。

在这篇论文，我们展现一个可以去比较以及分辨数据库以及分布式系统现存的复制协议的模型。
我们先开始介绍一个非常抽象的复制协议，展现我们认为的在任何复制策略中关键的阶段。
以这个抽象协议作为基准，我们分析数据库以及分布所系统的各种复制协议，展现其相似处和区别。
通过这些主意，我们参数化协议并对它们每个提供的问题提供一个准确的看法。
提供这样的分类可以有系统地探讨解决空间并给新的协议的发展提供一个良好的基线。
虽然这样的工作在本质上是概念性的，我们相信这是一个宝贵的贡献，因为它提供了对复制协议必要的视角。
但是，这些贡献不仅有指导意义，而且也非常实用。
近年来通过我们的工作， 许多研究人员已经开始探索相结合的数据库和分布式系统解决方案[RTKA96,SAA98，PMS99的，HAA99。
本文的结果将有助于说明哪些协议互为补充，以及它们如何被组合。

本文的组织如下。第2节介绍我们的复制功能模型，并讨论了一些我们用于比较的基础。
第3节和第4节分别呈现了复制协议在分布式系统和数据库的使用。
在这两种情况下，而不是集中在特定的协议，我们专注于更通用的复制算法。
第5细化讨论比第4节更复杂的事务模型。
第6章讨论了论文的不同方面，并给出了一个结论。

2 抽象化复制问题

数据库以及分布式系统的复制依赖如同的假设，并给客户端提供不一样的保障。
因此，要了解它的形式，复制必须被看作是一个抽象的问题。
在本节，我们讨论复制在数据库以及分布式系统的上下文，并介绍复制的功能模型。

2.1 复制上下文

此后，我们假设客户端提出的操作必须执行在系统的一系列副本上。系统的不同组件（客户端以及副本）通过消息交换的形式进行通讯。

在这个上下文，分布式系统分为同步以及异步模型。在异步模型，有相对处理速度以及消息传输延迟的约束，而在同步系统没有。
关键的区别是同步系统容许正确的崩溃检测，而异步系统不能（例如，在一个异步系统，当进程p认为进程q已经崩溃，其实q可能没有崩溃）。
不正确的崩溃检测导致开发复制算法更复杂。幸运的是，许多复杂度可以在组通讯原语下隐藏。
这是我们在这篇论文使用的方法（查看3.1节）

数据库不关心同步以及异步系统的根本性区别由于下面原因：数据库接受阻塞协议（协议被认为是阻塞的，当一些进程的崩溃可能会妨碍协议终止）。
阻塞型的协议在同步模型上比非阻塞协议设计的简单。分布式系统通常会寻找非阻塞协议。

这反映了分布式系统和数据库复制协议的另一个根本区别。
它已被证明每一个问题按规范可以被分解成的安全性和活性(liveness)[AS87]1，
作为协议规范的一部分,数据库协议不正式处理活性(liveness)问题。
事实上，事务确保的性质（原子性，一致性，隔离性，持久性）[GR93]所有都是安全性。
然而，由于数据库接受阻塞协议，活性不是一个问题。因此这篇论文我们专注于安全性。

最后，数据库复制协议认为在某些场景下可以人为进行干预去解决不寻常的问题，例如服务器异常，需要分配到另一台（避规阻塞的一种方式）。
在分布式系统协议中通常不这样做，而是在协议中设计了通过一个副本代替另一个（非阻塞协议)。

(safety property says that nothing bad ever happens, while a liveness property says that something good eventually happens.)

2.2 功能模型

一个复制协议可以通过5个通用的阶段进行描述。这些阶段代表了在协议中重要的步骤，而且可以用来区分不同的实现。
我们将在后面显示，一些复制技术可以跳过某些阶段，以不同的方式排序，遍历其中的一些或将它们合并到一个更简单的序列。
因此，协议可以通过它们实现这些阶段的放肆以及它们如果组合这些阶段进行比较。
这方面，一个抽象的复制协议可以被描述为一个以下五个阶段的顺序(图1)
    1. Request(RE):客户端请求一个或者多个副本
    2. Server coordination(SC):副本服务器互相协调以同步请求执行
    3. Execution(EX):操作在副本服务器上执行
    4. Agreement coordination(AC): 副本服务器认同执行结果
    5. Response(END):发送应答给客户端

这个功能模型表示了复制的基本步骤：提交操作，副本间协调（例如对并发操作排序）,执行操作，副本间进一步的协调（例如保证原子性），以及响应给客户端。
协议间的不同主要表现在每个阶段的不同实现，在某些情况，不需要某些阶段（例如当消息基于原子广播原语进行排序，协调同意阶段（AC）不需要了，既然它已经作为广播过程或者消息排序的一部分被执行了）。

在这个框架，我们首先认为事务是由单个操作组成的。可以是一个读或者写操作，一个有多个参数的更复杂的操作，或者对某个方法的调用。
一个更高级的事务模型将在第5节进行考虑。乍一看，这个模型被某些数据库供应商采纳，用于处理web文档和存储过程。


*请求阶段.* 在请求阶段，一个客户端发送操作到系统。这个可以有两种方式实现：客户端直接发送操作到所有的副本，或者客户端发送操作到一个副本，然后其在服务器协调阶段（SC）发送操作到其他副本。
这个区别尽管看起来简单，但是已经说明了数据库和分布式系统的显著不同。
在数据库，客户端从不联系所有副本，而且总是发送操作到其中一个。
原因很间打：复制应该对客户端透明。
可以发送操作到所有副本意味这客户端必须知道数据位置，结构，分布，这对于任何有平均规模的数据库都不可能。
这些信息依赖于数据库节点，因此，客户端必须发送操作到一个节点，由它发送到其它节点。
然而，在分布式系统，复制技术中一个明显的区别在于客户端是否直接发送操作到所有副本（例如主动复制）或者只发送到其中一个（例如被动复制）

可以这么说，在两种情况下，请求机制可以被看做与一个代理联系（一个数据库节点或者一个通讯模块），在这种情况下两种实现没有显著的区别。
观念上这是正确的。实际上，这是一个非常没用的抽象，在下面不同协议比对的时候继续讨论。
对于此时应该主义的是分布式系统主要处理的是流程而数据库处理的是关系型结构。一系列流程处理起来比数据库模型简单，例如一个通讯模块可以被认为可以处理一系列流程但是假设其能处理数据库结构这不现实。
特别的是，数据库复制需要理解将要执行操作的语义，而在分布式系统，操作语义通常都无任何作用。

最后，分布式系统区分确定性和非确定性的复制行为。确定性复制行为表示当以相同顺序执行相同的操作，副本将产生相同结果。
这个假设在数据库非常难实现。因此，如果不同的副本通过任何方式通讯为了对结果达成一致，它也能交换实际的操作。
通过将广播请求的负担移交给服务器段，客户端以降低容错性使其所需的逻辑大大简化。
如果容错性是必须的，可以使用一个备份系统，对于客户端是透明的。

服务器协调阶段.在服务器协调阶段，不同的副本尝试去找一个操作执行的顺序。协议间最大的不同在于排序策略，排序机制或者正确性标准。
就排序测路额而言，数据库通过数据依赖进行操作排序。就是在所有副本的所有操作必须有相同的数据依赖。这是由于在数据库复制中操作语义发挥重要作用：读数据项的操作和修改数据项的操作不一样，因为在这两种情况数据依赖不同。
如果两个操作没有任何依赖，它们不需要排序，因为顺序没有关系。另一方面，分布式系统通常基于非常严格的概念上进行排序。
从基于潜在依赖而不是操作语义的因果关系到全序，所有的操作不管是什么都被排序。

就正确性而言，数据库

3 分布式系统复制

3.1 复制模型以及抽象

3.2 主动复制

3.3 被动复制

3.4 半主动复制

3.5 半被动复制

3.6 总结

4 数据库复制

...

4.1 数据库复制模型

...

4.2 复制策略

...

4.X X

...
